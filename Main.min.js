"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function MoeNotification(a){var b=this;this.display=function(a,c,d){var e=d||function(){},f=a||"喵~",g=c||"success";$("#MoeNotification").append($("<div>").addClass("MoeNotification-notice").addClass("MoeNotification-notice-"+g).append("<span>"+f+"</span>").fadeIn(300)),b.bind(),b.clear(),e($("#MoeNotification").find(".MoeNotification-notice").last())},this.create={success:function(a,c){var d=c||function(){};b.display(a,"success",d)},warning:function(a,c){var d=c||function(){};b.display(a,"warning",d)},error:function(a,c){var d=c||function(){};b.display(a,"error",d)}},this.clear=function(){return $(".MoeNotification-notice").length>=10?($("#MoeNotification").children().first().fadeOut(150,function(){$(this).remove()}),void setTimeout(b.clear,300)):!1},this.empty=function(a){$(".MoeNotification-notice").each(function(b){if($.isFunction(a)){var c=this;setTimeout(function(){a($(c))},200*b)}else $(this).delay(200*b).fadeOut("fast",function(){$(this).remove()})})},this.bind=function(){$(".MoeNotification-notice").mouseover(function(){b.slideLeft($(this))})},window.slideLeft=this.slideLeft=function(a,b){a.css("position","relative"),a.animate({left:"-200%"},b||150,function(){$(this).fadeOut("fast",function(){$(this).remove()})})},this.init=function(){$("body").append('<div id="MoeNotification"></div>')},$("#MoeNotification").length>0||this.init()}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();$(function(){function a(a){var b=window.navigator.language.toLowerCase();return e[b]&&e[b][a]?e[b][a]:e["zh-cn"][a]?e["zh-cn"][a]:"undefined"}function b(b){var c={unknown_error_name:{number:1001,message:a("unknown_error_name")},api_unaccessiable:{number:1002},api_unwriteable:{number:1003},fail_to_get_timestamp:{number:1004},fail_to_get_edittoken:{number:1005},fail_to_get_pageinfo:{number:1006},not_autoconfirmed_user:{number:1007},hit_abusefilter:{number:1008},unknown_edit_error:{number:1009},unknown_edit_error_message:{number:1010},notitle:{number:1011},notext:{number:1012},notoken:{number:1013},invalidsection:{number:1014},protectedtitle:{number:1015},cantcreate:{number:1016},cantcreate_anon:{number:1017},articleexists:{number:1018},noimageredirect_anon:{number:1019},noimageredirect:{number:1020},spamdetected:{number:1021},filtered:{number:1022},contenttoobig:{number:1023},noedit_anon:{number:1025},noedit:{number:1026},pagedeleted:{number:1027},emptypage:{number:1028},emptynewsection:{number:1029},editconflict:{number:1030},revwrongpage:{number:1031},undofailure:{number:1032},missingtitle:{number:1033},mustbeposted:{number:1034},readapidenied:{number:1035},writeapidenied:{number:1036},noapiwrite:{number:1037},badtoken:{number:1038},missingparam:{number:1039},invalidparammix:{number:1040},invalidtitle:{number:1041},nosuchpageid:{number:1042},pagecannotexist:{number:1043},nosuchrevid:{number:1044},badmd5:{number:1045},hookaborted:{number:1046},parseerror:{number:1047},summaryrequired:{number:1048},blocked:{number:1049},ratelimited:{number:1050},unknownerror:{number:1051},nosuchsection:{number:1052},sectionsnotsupported:{number:1053},editnotsupported:{number:1054},appendnotsupported:{number:1055},redirect_appendonly:{number:1056},badformat:{number:1057},customcssprotected:{number:1058},customjsprotected:{number:1059},cascadeprotected:{number:1060},network_edit_error:{number:1061},need_init:{number:1062},fail_to_get_wikitext:{number:1063},fail_to_init_quickedit:{number:1064},fail_to_get_wikitext_when_edit:{number:1065},cant_parse_wikitext:{number:1066},empty_page_confirm:{number:1067}};return c[b]?c[b].message?{number:c[b].number,message:c[b].message}:"undefined"!==a(b)?{number:c[b].number,message:a(b)}:{number:c[b].number,message:"未知错误"}:{number:c.unknown_error_name.number,message:c.unknown_error_name.message}}function c(a){var b=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];return-1===$.inArray(a,b)?!1:!0}function d(a,c){var d=b(a),e=new Error;return e.number=d.number,e.message=c||d.message,console.log("%c致命错误["+e.number+"]:"+e.message,"color:red"),e}var e={},f="http:"==location.protocol?"http://miku.host.smartgslb.com/wikiplus":"https://blog.kotori.moe/wikiplus";e["zh-cn"]={__language:"zh-cn",__author:["Eridanus Sora"],unknown_error_name:"未知的错误名",api_unaccessiable:"无可用的API",api_unwriteable:"无可用的写入API",fail_to_get_timestamp:"无法获得页面编辑起始时间戳",fail_to_get_edittoken:"无法获得页面编辑权标",fail_to_get_pageinfo:"无法获得页面信息",not_autoconfirmed_user:"非自动确认用户",hit_abusefilter:"被防滥用过滤器拦截",unknown_edit_error:"未知编辑错误",unknown_edit_error_message:"未知编辑错误($1)",notitle:"无法编辑空标题页面",notext:"缺少页面内容",notoken:"空编辑权标",invalidsection:"段落编号非法",protectedtitle:"该标题被保护，无法创建",cantcreate:"无新建页面权限",cantcreate_anon:"匿名用户无新建页面权限",articleexists:"无法创建已经存在的页面",noimageredirect_anon:"匿名用户无新建文件重定向权限",noimageredirect:"无新建文件重定向权限",spamdetected:"文本含有敏感内容，被SPAM过滤器拦截",filtered:"编辑被过滤器拦截",contenttoobig:"文本超过最大长度限制",noedit_anon:"匿名用户无编辑页面权限",noedit:"无编辑页面权限",pagedeleted:"编辑时，此页面被删除",emptypage:"无法新建空内容页面",emptynewsection:"无法新建空内容段落",editconflict:"编辑冲突，请手工检查页面当前内容与提交内容差异并修正后，刷新页面提交",revwrongpage:"编辑的修订版本与编辑的页面不匹配",undofailure:"由于存在冲突的中间版本，无法撤销编辑",missingtitle:"无法创建或编辑空标题页面",mustbeposted:"必须使用POST方式提交编辑",readapidenied:"无读取API使用权限",writeapidenied:"无通过API编辑页面权限",noapiwrite:"本Wiki未开启可用的写入API",badtoken:"非法的编辑权标",missingparam:"缺少必要参数，页面名和页面ID不能均为空",invalidparammix:"参数重复，页面名和页面ID不能同时给定",invalidtitle:"非法的标题",nosuchpageid:"不存在的页面ID",pagecannotexist:"该名称空间不允许新建一般页面",nosuchrevid:"不存在的修订版本",badmd5:"非法的MD5值",hookaborted:"编辑被扩展Hook拦截",parseerror:"无法解析页面文本",summaryrequired:"编辑摘要不能为空",blocked:"已被封禁",ratelimited:"达到操作速率上限，请稍后重试",unknownerror:"未知错误",nosuchsection:"无法编辑不存在的段落",sectionsnotsupported:"该页面不支持段落编辑",editnotsupported:"该页面不支持通过API编辑",appendnotsupported:"该页面无法在前后插入文本",redirect_appendonly:"在遵循重定向的情况下，只能进行前后插入或创建新段落",badformat:"文本格式错误",customcssprotected:"无法编辑用户CSS页",customjsprotected:"无法编辑用户JS页",cascadeprotected:"该页面被级联保护",network_edit_error:"由于网络原因编辑失败",redirect_to_summary:"重定向页面至 [[$1]] // Wikiplus",redirect_from_summary:"将[[$1]]重定向至[[$2]] // Wikiplus",need_init:"页面类未加载完成",fail_to_get_wikitext:"无法获得页面文本",quickedit_topbtn:"快速编辑",quickedit_sectionbtn:"快速编辑",fail_to_init_quickedit:"无法加载快速编辑",back:"返回",goto_editbox:"到编辑框",summary_placehold:"请输入编辑摘要",submit:"提交",preview:"预览",mark_minoredit:"标记为小编辑",onclose_confirm:"[Wikiplus] 您确认要关闭/刷新页面吗 这会导致您的编辑数据丢失",fail_to_get_wikitext_when_edit:"无法获得页面文本以编辑",cant_parse_wikitext:"无法解析维基文本",loading_preview:"正在读取预览",submitting_edit:"正在提交编辑",edit_success:"编辑成功 用时$1ms",empty_page_confirm:"您向编辑函数传入了空内容参数 这将清空页面\r\n由于该行为危险 请将config参数的empty键值设定为true来确认",cross_page_edit:"编辑目标位于其他页面 正在获取基础信息",cross_page_edit_submit:"基础信息获取成功 正在提交编辑",cross_page_edit_error:"无法获得基础信息>.<",install_tip:"您是否允许Wikiplus采集非敏感数据用于改进Wikiplus及为当前Wiki: $1 提供改进建议?",accept:"接受",decline:"拒绝",install_finish:"Wikiplus安装完毕",loading:"正在载入"},e["en-us"]={__language:"en-us",__author:["Eridanus Sora"],accept:"Accept",decline:"Decline"};var g=function(){function b(){var a=arguments.length<=0||void 0===arguments[0]?window.mw.config.values.wgPageName:arguments[0];_classCallCheck(this,b);return console.log("页面类构建中"),window.mw?window.mw.config.values.wgEnableAPI&&window.mw.config.values.wgEnableWriteAPI?c("autoconfirmed",window.mw.config.values.wgUserGroups)?(this.pageName=a.replace(/ /gi,"_"),this.revisionId=window.mw.config.values.wgRevisionId,this.articleId=window.mw.config.values.wgArticleId,this.API=location.protocol+"//"+location.host+window.mw.config.values.wgScriptPath+"/api.php",this.editToken={},this.timeStamp={},void this.init(this.pageName,{success:function(){console.log("Wikiplus加载完毕")},fail:function(a){console.log("Wikiplus未能正确加载("+a.message+")")}})):void d("not_autoconfirmed_user"):void d("api_unaccessiable"):void console.log("页面Javascript载入不完全或这不是一个Mediawiki站点")}return _createClass(b,[{key:"reConstruct",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this.init(a,b)}},{key:"init",value:function(a,b,c){void 0===a&&(a=this.pageName),void 0===b&&(b={});var e=this;b.success=b.success||new Function,b.fail=b.success||new Function,$.ajax({type:"GET",dataType:"json",url:this.API,data:{action:"query",prop:"revisions|info",titles:a,rvprop:"timestamp",intoken:"edit",format:"json"},beforeSend:function(){console.time("获得页面基础信息时间耗时")},success:function(c){if(c&&c.query&&c.query.pages){var f=c.query.pages;for(var g in f)"-1"!==g?(f[g].revisions&&f[g].revisions.length>0?e.timeStamp[a]=f[g].revisions[0].timestamp:b.fail(d("fail_to_get_timestamp")),f[g].edittoken&&("+\\"!=f[g].edittoken?e.editToken[a]=f[g].edittoken:(console.log("无法通过API获得编辑令牌，可能是空页面，尝试通过前端API获取通用编辑令牌"),e.editToken[a]=window.mw.user.tokens.get("editToken"),e.editToken[a]&&"+\\"!=e.editToken[a]?console.log("成功获得通用编辑令牌 来自前端API"):b.fail(d("fail_to_get_edittoken"))))):(b.fail(d("fail_to_get_pageinfo")),e.inited=!1)}}}).done(function(){console.timeEnd("获得页面基础信息时间耗时"),e.inited=!0,b.success()})}},{key:"edit",value:function(b){var c=arguments.length<=1||void 0===arguments[1]?this.pageName:arguments[1],e=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],f=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],g=this;return e.success=e.success||new Function,e.fail=e.fail||new Function,void 0===b&&!f.empty==!0?(e.fail(d("empty_page_confirm")),!1):void(g.inited?$.ajax({type:"POST",url:g.API,data:$.extend({action:"edit",format:"json",text:b,title:c,token:g.editToken[c],basetimestamp:g.timeStamp[c]},f),success:function(b){b&&b.edit?b.edit.result&&"Success"==b.edit.result?e.success():b.edit.code?e.fail(d("hit_abusefilter","触发防滥用过滤器:"+b.edit.info.replace("/Hit AbuseFilter: /ig","")+"<br><small>"+b.edit.warning+"</small>")):e.fail(d("unknown_edit_error")):b&&b.error&&b.error.code?e.fail(d(b.error.code.replace(/-/gi,"_")),a("unknown_edit_error_message").replace(/\$1/gi,b.error.code)):b.code?e.fail(d("unknown_edit_error"),a("unknown_edit_error_message").replace(/\$1/gi,b.code)):e.fail(d("unknown_edit_error"))},error:function(a){e.fail(d("network_edit_error"))}}):e.fail(d(1017,"页面类未加载完成")))}},{key:"editSection",value:function(a,b){var c=arguments.length<=2||void 0===arguments[2]?this.pageName:arguments[2],d=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],e=arguments.length<=4||void 0===arguments[4]?{}:arguments[4];e.success=e.success||new Function,e.fail=e.fail||new Function,this.edit(b,c,e,$.extend({section:a},d))}},{key:"redirectTo",value:function(b){var c=arguments.length<=1||void 0===arguments[1]?this.pageName:arguments[1],d=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];d.success=d.success||new Function,d.fail=d.fail||new Function,this.edit("#REDIRECT [["+b+"]]",c,d,{summary:a("redirect_to_summary").replace(/\$1/gi,b)})}},{key:"redirectFrom",value:function(b){var c=arguments.length<=1||void 0===arguments[1]?this.pageName:arguments[1],d=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];d.success=d.success||new Function,d.fail=d.fail||new Function,this.edit("#REDIRECT [["+c+"]]",b,d,{summary:a("redirect_from_summary").replace(/\$1/gi,b).replace(/\$2/gi,c)})}},{key:"getWikiText",value:function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=arguments.length<=1||void 0===arguments[1]?this.pageName:arguments[1],c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];a.success=a.success||new Function,a.fail=a.fail||new Function,$.ajax({url:location.protocol+"//"+location.host+mw.config.values.wgScriptPath+"/index.php",type:"GET",dataType:"text",cache:!1,data:$.extend({title:b,action:"raw"},c),beforeSend:function(){console.time("获得页面文本耗时")},success:function(b){a.success(b)},error:function(b){a.fail(d("fail_to_get_wikitext"))}})}},{key:"parseWikiText",value:function(a,b,c){void 0===a&&(a=""),void 0===b&&(b={}),b.success=b.success||new Function,b.fail=b.fail||new Function,$.ajax({type:"POST",dataType:"json",data:$.extend({format:"json",action:"parse",text:a,title:this.pageName,pst:"true"},c),url:this.API,success:function(a){a&&a.parse&&a.parse.text?b.success(a.parse.text["*"]):b.fail(d("cant_parse_wikitext"))}})}}]),b}();$(document).ready(function(){var b=function(){function b(){_classCallCheck(this,b),this.version="2.0.0.0",this.releaseNote="修正了版本号过低的问题",this.notice=new MoeNotification,this.inValidNameSpaces=[-1,8964],console.log("正在加载Wikiplus "+this.version),$("head").append("<link>");var a=$("head").children(":last");a.attr({rel:"stylesheet",type:"text/css",href:f+"/wikiplus.css"}),this.preloadData={},this.checkInstall(),c(mw.config.values.wgNameSpaceNumber,this.inValidNameSpaces)||(this.kotori=new g,this.initBasicFunctions())}return _createClass(b,[{key:"initQuickEdit",value:function(){var b=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],c=this;b.success=b.success||new Function,b.fail=b.fail||new Function;var e=$("<li>").attr("id","Wikiplus-Edit-TopBtn").append($("<span>").append($("<a>").attr("href","javascript:void(0)").text(""+a("quickedit_topbtn")))).data({number:-1,target:c.kotori.pageName});if($("#ca-edit").length>0&&0==$("#Wikiplus-Edit-TopBtn").length&&$("#ca-edit").before(e),$(".mw-editsection").length>0){c.sectionMap={};var f=$("<span>").append($("<span>").attr("id","mw-editsection-bracket").text("[")).append($("<a>").addClass("Wikiplus-Edit-SectionBtn").attr("href","javascript:void(0)").text(a("quickedit_sectionbtn"))).append($("<span>").attr("id","mw-editsection-bracket").text("]"));$(".mw-editsection").each(function(a){try{var b=$(this).find("a").attr("href"),e=b.match(/&section\=(.+)/)[1],g=decodeURI(b.match(/title=(.+?)&/)[1]),h=$(this).prev().text();c.sectionMap[e]={name:h,target:g};var i=f.clone();i.find(".Wikiplus-Edit-SectionBtn").data({number:e,name:h,target:g}),$(this).append(i)}catch(j){d("fail_to_init_quickedit")}})}$(".Wikiplus-Edit-SectionBtn").click(function(){c.initQuickEditInterface($(this))}),$("#Wikiplus-Edit-TopBtn").click(function(){c.initQuickEditInterface($(this))})}},{key:"initQuickEditInterface",value:function(b){var c=this,e=b.data("number"),f=(b.data("name"),b.data("target"));this.kotori.inited&&(console.log(f+"."+e),void 0===this.preloadData[f+"."+e]?(this.notice.create.success(a("loading")),this.preload(e,f,{success:function(a){b.data("content",a),c.notice.empty(),c.displayQuickEditInterface(b)},fail:function(a){d("fail_to_get_wikitext_when_edit")}})):(console.log(f+"."+e+"已预读取"),b.data("content",c.preloadData[f+"."+e]),c.displayQuickEditInterface(b)))}},{key:"displayQuickEditInterface",value:function(b){var c=this,d=b.data("number"),e=(b.data("name"),b.data("target")),f=b.data("content"),g=$(document).scrollTop(),h=$("<span>").attr("id","Wikiplus-Quickedit-Back").addClass("Wikiplus-Btn").text(""+a("back")),i=$("<span>").attr("id","Wikiplus-Quickedit-Jump").addClass("Wikiplus-Btn").append($("<a>").attr("href","#Wikiplus-Quickedit").text(""+a("goto_editbox"))),j=$("<textarea>").attr("id","Wikiplus-Quickedit"),k=$("<div>").attr("id","Wikiplus-Quickedit-Preview-Output"),l=$("<input>").attr("id","Wikiplus-Quickedit-Summary-Input").attr("placeholder",""+a("summary_placehold")),m=$("<button>").attr("id","Wikiplus-Quickedit-Submit").text(a("submit")+"(Ctrl+S)"),n=$("<button>").attr("id","Wikiplus-Quickedit-Preview-Submit").text(""+a("preview")),o=$("<div>").append($("<input>").attr({type:"checkbox",id:"Wikiplus-Quickedit-MinorEdit"})).append($("<label>").attr("for","Wikiplus-Quickedit-MinorEdit").text(a("mark_minoredit")+"(Ctrl+Shift+S)")).css({margin:"5px 5px 5px -3px",display:"inline"}),p=$("<div>").append(h,i,k,j,l,$("<br>"),o,m,n);this.createDialogBox("快速编辑",p,1e3,function(){$("#Wikiplus-Quickedit").text(f),$("#Wikiplus-Quickedit-Back").click(function(){$(".Wikiplus-InterBox").fadeOut("fast",function(){window.onclose=window.onbeforeunload=void 0,$(this).remove()})});var b=$("<div>").addClass("Wikiplus-Banner").text(""+a("loading_preview"));$("#Wikiplus-Quickedit-Preview-Submit").click(function(){var a=$("#Wikiplus-Quickedit").val();$(this).attr("disabled","disabled"),$("#Wikiplus-Quickedit-Preview-Output").fadeOut(100,function(){$("#Wikiplus-Quickedit-Preview-Output").html("").append(b),$("#Wikiplus-Quickedit-Preview-Output").fadeIn(100)}),$("body").animate({scrollTop:g},200),c.kotori.parseWikiText(a,{success:function(a){$("#Wikiplus-Quickedit-Preview-Output").fadeOut("100",function(){$("#Wikiplus-Quickedit-Preview-Output").html('<hr><div class="mw-body-content">'+a+"</div><hr>"),$("#Wikiplus-Quickedit-Preview-Output").fadeIn("100"),$("#Wikiplus-Quickedit-Preview-Submit").removeAttr("disabled")})}})}),$("#Wikiplus-Quickedit-Submit").click(function(){var b=$("#Wikiplus-Quickedit").val(),f=$("#Wikiplus-Quickedit-Summary-Input").val(),h=(new Date).valueOf(),i=$("<div>").addClass("Wikiplus-Banner").text(""+a("submitting_edit")),j={summary:f};-1!==d&&(j.section=d),$("#Wikiplus-Quickedit-MinorEdit").is(":checked")&&(j.minor="true"),$("#Wikiplus-Quickedit-Submit,#Wikiplus-Quickedit,#Wikiplus-Quickedit-Preview-Submit").attr("disabled","disabled"),$("body").animate({scrollTop:g},200),e===c.kotori.pageName?($("#Wikiplus-Quickedit-Preview-Output").fadeOut(100,function(){$("#Wikiplus-Quickedit-Preview-Output").html("").append(i),$("#Wikiplus-Quickedit-Preview-Output").fadeIn(100)}),c.kotori.edit(b,e,{success:function(){var b=(new Date).valueOf()-h;$("#Wikiplus-Quickedit-Preview-Output").find(".Wikiplus-Banner").css("background","rgba(6, 239, 92, 0.44)"),$("#Wikiplus-Quickedit-Preview-Output").find(".Wikiplus-Banner").text((""+a("edit_success")).replace(/\$1/gi,b.toString())),c.sendStatistic(e,b),window.onclose=window.onbeforeunload=void 0,setTimeout(function(){location.reload()},500)},fail:function(a){console.log(a),$("#Wikiplus-Quickedit-Submit,#Wikiplus-Quickedit,#Wikiplus-Quickedit-Preview-Submit").removeAttr("disabled"),$(".Wikiplus-Banner").css("background","rgba(218, 142, 167, 0.65)"),console.log($(".Wikiplus-Banner").text(a.message))}},j)):($("#Wikiplus-Quickedit-Preview-Output").fadeOut(100,function(){$("#Wikiplus-Quickedit-Preview-Output").html("").append(i.text(a("cross_page_edit"))),$("#Wikiplus-Quickedit-Preview-Output").fadeIn(100)}),c.kotori.reConstruct(e,{success:function(){$(".Wikiplus-Banner").text(a("cross_page_edit_submit")),c.kotori.edit(b,e,{success:function(){var b=(new Date).valueOf()-h;$("#Wikiplus-Quickedit-Preview-Output").find(".Wikiplus-Banner").css("background","rgba(6, 239, 92, 0.44)"),$("#Wikiplus-Quickedit-Preview-Output").find(".Wikiplus-Banner").text((""+a("edit_success")).replace(/\$1/gi,b)),c.sendStatistic(e,b),window.onclose=window.onbeforeunload=void 0,setTimeout(function(){location.reload()},500)},fail:function(a){$("#Wikiplus-Quickedit-Submit,#Wikiplus-Quickedit,#Wikiplus-Quickedit-Preview-Submit").removeAttr("disabled"),$(".Wikiplus-Banner").css("background","rgba(218, 142, 167, 0.65)"),$(".Wikiplus-Banner").text(a.message)}},j)},fail:function(b){$(".Wikiplus-Banner").css("background","rgba(218, 142, 167, 0.65)"),$(".Wikiplus-Banner").text(a("cross_page_edit_error"))}}))}),$("#Wikiplus-Quickedit,#Wikiplus-Quickedit-Summary-Input,#Wikiplus-Quickedit-MinorEdit").keydown(function(a){a.ctrlKey&&83==a.which&&(a.shiftKey&&$("#Wikiplus-Quickedit-MinorEdit").click(),$("#Wikiplus-Quickedit-Submit").click(),a.preventDefault(),a.stopPropagation())}),$("#Wikiplus-Quickedit").keydown(function(){window.onclose=window.onbeforeunload=function(){return""+a("onclose_confirm")}})})}},{key:"createDialogBox",value:function(){var a=arguments.length<=0||void 0===arguments[0]?"对话框":arguments[0],b=arguments.length<=1||void 0===arguments[1]?"":arguments[1],c=arguments.length<=2||void 0===arguments[2]?600:arguments[2],d=arguments.length<=3||void 0===arguments[3]?new Function:arguments[3];$(".Wikiplus-InterBox").length>0&&$(".Wikiplus-InterBox").each(function(){$(this).remove()});var e=document.body.clientWidth,f=document.body.clientHeight,g=$("<div>").addClass("Wikiplus-InterBox").css({"margin-left":e/2-c/2,top:$(document).scrollTop()+.2*f,display:"none"}).append($("<div>").addClass("Wikiplus-InterBox-Header").text(a)).append($("<div>").addClass("Wikiplus-InterBox-Content").append(b)).append($("<span>").text("×").addClass("Wikiplus-InterBox-Close"));$("body").append(g),$(".Wikiplus-InterBox").width(c),$(".Wikiplus-InterBox-Close").click(function(){$(this).parent().fadeOut("fast",function(){window.onclose=window.onbeforeunload=void 0,$(this).remove()})}),$(".Wikiplus-InterBox").fadeIn(500),d()}},{key:"preload",value:function(){var a=arguments.length<=0||void 0===arguments[0]?-1:arguments[0],b=arguments.length<=1||void 0===arguments[1]?this.kotori.pageName:arguments[1],c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];c.success=c.success||new Function,c.fail=c.fail||new Function;var d=this;return this.preloadData[b+"."+a]?(console.log(b+"."+a+"段落已经预读取 跳过本次预读取"),void c.success()):void this.kotori.getWikiText({success:function(e){d.preloadData[b+"."+a]=e,console.log("预读取"+b+"."+a),c.success(e)},fail:function(d){console.log("预读取"+b+"."+a+"失败:"+d.message),c.fail(d)}},b,{section:-1===a?"":a})}},{key:"sendStatistic",value:function(a,b){void 0===a&&(a=mw.config.values.wgPageName),"True"==localStorage.Wikiplus_SendStatistics&&$.ajax({url:f+"/statistic.php",type:"POST",dataType:"json",data:{wikiname:mw.config.values.wgSiteName,usetime:b,username:mw.config.values.wgUserName,pagename:a},success:function(a){}})}},{key:"checkInstall",value:function(b){var c=this;if(!localStorage.Wikiplus_Installed||"False"==localStorage.Wikiplus_Installed){var d=function(){localStorage.Wikiplus_Installed="True",localStorage.Wikiplus_Version=c.version,localStorage.Wikiplus_StartUseAt=(new Date).valueOf(),localStorage.Wikiplus_SrartEditCount=mw.config.values.wgUserEditCount,localStorage.Wikiplus_Settings=JSON.stringify(c.defaultSettings),$(".Wikiplus-InterBox").fadeOut("fast",function(){c.notice.create.success(a("install_finish")),$(this).remove()})},e=$("<div>").text(a("install_tip").replace(/\$1/gi,mw.config.values.wgSiteName)).attr("id","Wikiplus-InterBox-Content"),f=$("<div>").addClass("Wikiplus-InterBox-Btn").attr("id","Wikiplus-Setting-Apply").text(a("accept")),g=$("<div>").addClass("Wikiplus-InterBox-Btn").attr("id","Wikiplus-Setting-Cancel").text(a("decline")),h=$("<div>").append(e).append($("<hr>")).append(f).append(g);c.createDialogBox("安装Wikiplus",h,600,function(){$("#Wikiplus-InterBox-Content").css("text-align","left"),$("#Wikiplus-Setting-Apply").click(function(){localStorage.Wikiplus_SendStatistics="True",d()}),$("#Wikiplus-Setting-Cancel").click(function(){localStorage.Wikiplus_SendStatistics="False",d()})})}}},{key:"initBasicFunctions",value:function(){this.initQuickEdit()}},{key:"initRecentChangesPageFunctions",value:function(){}},{key:"initAdvancedFunctions",value:function(){}}]),b}();window.Wikiplus=new b})});