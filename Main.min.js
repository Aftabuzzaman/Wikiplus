"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function MoeNotification(a){var b=this;this.display=function(a,c,d){var e=d||function(){},f=a||"喵~",g=c||"success";$("#MoeNotification").append($("<div>").addClass("MoeNotification-notice").addClass("MoeNotification-notice-"+g).append("<span>"+f+"</span>").fadeIn(300)),b.bind(),b.clear(),e($("#MoeNotification").find(".MoeNotification-notice").last())},this.create={success:function(a,c){var d=c||function(){};b.display(a,"success",d)},warning:function(a,c){var d=c||function(){};b.display(a,"warning",d)},error:function(a,c){var d=c||function(){};b.display(a,"error",d)}},this.clear=function(){return $(".MoeNotification-notice").length>=10?($("#MoeNotification").children().first().fadeOut(150,function(){$(this).remove()}),void setTimeout(b.clear,300)):!1},this.empty=function(a){$(".MoeNotification-notice").each(function(b){if($.isFunction(a)){var c=this;setTimeout(function(){a($(c))},200*b)}else $(this).delay(200*b).fadeOut("fast",function(){$(this).remove()})})},this.bind=function(){$(".MoeNotification-notice").mouseover(function(){b.slideLeft($(this))})},window.slideLeft=this.slideLeft=function(a,b){a.css("position","relative"),a.animate({left:"-200%"},b||150,function(){$(this).fadeOut("fast",function(){$(this).remove()})})},this.init=function(){$("body").append('<div id="MoeNotification"></div>')},$("#MoeNotification").length>0||this.init()}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();$(function(){var a=function(){function a(){var b=arguments.length<=0||void 0===arguments[0]?window.mw.config.values.wgPageName:arguments[0];_classCallCheck(this,a);var c=this;return console.log("Now Loading Wikiplus"),window.mw?window.mw.config.values.wgEnableAPI&&window.mw.config.values.wgEnableWriteAPI?c.inArray("autoconfirmed",window.mw.config.values.wgUserGroups)?(c.pageName=b.replace(/ /gi,"_"),c.revisionId=window.mw.config.values.wgRevisionId,c.articleId=window.mw.config.values.wgArticleId,c.API=location.protocol+"//"+location.host+window.mw.config.values.wgScriptPath+"/api.php",void $.ajax({type:"GET",dataType:"json",url:c.API,data:{action:"query",prop:"revisions|info",titles:c.pageName,rvprop:"timestamp",intoken:"edit",format:"json"},beforeSend:function(){console.time("获得页面基础信息时间耗时")},success:function(a){if(a&&a.query&&a.query.pages){var b=a.query.pages;for(var d in b)"-1"!==d?(b[d].revisions&&b[d].revisions.length>0?c.timeStamp=b[d].revisions[0].timestamp:c.throwError(1004,"无法获得页面时间戳"),b[d].edittoken&&("+\\"!=b[d].edittoken?c.editToken=b[d].edittoken:(console.log("无法通过API获得编辑令牌，可能是空页面，尝试通过前端API获取通用编辑令牌"),c.editToken=window.mw.user.tokens.get("editToken"),c.editToken&&"+\\"!=c.editToken?console.log("成功获得通用编辑令牌 来自前端API"):c.throwError(1005,"无法获得页面编辑令牌 请确认登录状态")))):(c.throwError(1007,"无法获得页面基础信息"),c.inited=!0)}}})):void c.throwError(1001,"非自动确认用户"):void c.throwError(1e3,"无可用的API"):void console.log("页面Javascript载入不完全或这不是一个Mediawiki站点")}return _createClass(a,[{key:"throwError",value:function(){var a=arguments.length<=0||void 0===arguments[0]?0:arguments[0],b=arguments.length<=1||void 0===arguments[1]?"未知错误":arguments[1];console.log("%c致命错误["+a+"]:"+b,"color:red")}},{key:"throwWarning",value:function(){var a=arguments.length<=0||void 0===arguments[0]?0:arguments[0],b=arguments.length<=1||void 0===arguments[1]?"未知异常":arguments[1];console.log("%c异常["+a+"]:"+b,"color:#F3C421")}},{key:"inArray",value:function(a,b){return-1===$.inArray(a,b)?!1:!0}}]),a}();$(document).ready(function(){var b=function c(){_classCallCheck(this,c);var b=this;b.kotori=new a};new b})});