(()=>{"use strict";const e=JSON.parse('{"__language":"zh-cn","__author":["Eridanus Sora"],"__version":"209","unknown_error_name":"未知的错误名","api_unaccessiable":"无可用的API","api_unwriteable":"无可用的写入API","fail_to_get_timestamp":"无法获得页面编辑起始时间戳","fail_to_get_edittoken":"无法获得页面编辑权标","fail_to_get_pageinfo":"无法获得页面信息","not_autoconfirmed_user":"非自动确认用户","hit_abusefilter":"被防滥用过滤器拦截","unknown_edit_error":"未知编辑错误","unknown_edit_error_message":"未知编辑错误($1)","notitle":"无法编辑空标题页面","notext":"缺少页面内容","notoken":"空编辑权标","invalidsection":"段落编号非法","protectedtitle":"该标题被保护，无法创建","cantcreate":"无新建页面权限","cantcreate_anon":"匿名用户无新建页面权限","articleexists":"无法创建已经存在的页面","noimageredirect_anon":"匿名用户无新建文件重定向权限","noimageredirect":"无新建文件重定向权限","spamdetected":"文本含有敏感内容，被SPAM过滤器拦截","filtered":"编辑被过滤器拦截","contenttoobig":"文本超过最大长度限制","noedit_anon":"匿名用户无编辑页面权限","noedit":"无编辑页面权限","pagedeleted":"编辑时，此页面被删除","emptypage":"无法新建空内容页面","emptynewsection":"无法新建空内容段落","editconflict":"编辑冲突，请手工检查页面当前内容与提交内容差异并修正后，刷新页面提交","revwrongpage":"编辑的修订版本与编辑的页面不匹配","undofailure":"由于存在冲突的中间版本，无法撤销编辑","missingtitle":"无法创建或编辑空标题页面","mustbeposted":"必须使用POST方式提交编辑","readapidenied":"无读取API使用权限","writeapidenied":"无通过API编辑页面权限","noapiwrite":"本Wiki未开启可用的写入API","badtoken":"非法的编辑权标","missingparam":"缺少必要参数，页面名和页面ID不能均为空","invalidparammix":"参数重复，页面名和页面ID不能同时给定","invalidtitle":"非法的标题","nosuchpageid":"不存在的页面ID","pagecannotexist":"该名称空间不允许新建一般页面","nosuchrevid":"不存在的修订版本","badmd5":"非法的MD5值","hookaborted":"编辑被扩展Hook拦截","parseerror":"无法解析页面文本","summaryrequired":"编辑摘要不能为空","blocked":"已被封禁","ratelimited":"达到操作速率上限，请稍后重试","unknownerror":"未知错误","nosuchsection":"无法编辑不存在的段落","sectionsnotsupported":"该页面不支持段落编辑","editnotsupported":"该页面不支持通过API编辑","appendnotsupported":"该页面无法在前后插入文本","redirect_appendonly":"在遵循重定向的情况下，只能进行前后插入或创建新段落","badformat":"文本格式错误","customcssprotected":"无法编辑用户CSS页","customjsprotected":"无法编辑用户JS页","cascadeprotected":"该页面被级联保护","network_edit_error":"由于网络原因编辑失败","redirect_to_summary":"重定向页面至 [[$1]] // Wikiplus","redirect_from_summary":"将[[$1]]重定向至[[$2]] // Wikiplus","need_init":"页面类未加载完成","fail_to_get_wikitext":"无法获得页面文本","quickedit_topbtn":"快速编辑","quickedit_sectionbtn":"快速编辑","fail_to_init_quickedit":"无法加载快速编辑","back":"返回","goto_editbox":"到编辑框","summary_placehold":"请输入编辑摘要","submit":"提交","publish_page":"发布页面","publish_change":"发布更改","preview":"预览","cancel":"取消","mark_minoredit":"标记为小编辑","onclose_confirm":"[Wikiplus] 您确认要关闭/刷新页面吗 这会导致您的编辑数据丢失","fail_to_get_wikitext_when_edit":"无法获得页面文本以编辑","cant_parse_wikitext":"无法解析维基文本","loading_preview":"正在读取预览","submitting_edit":"正在提交编辑","edit_success":"编辑成功 用时$1ms","empty_page_confirm":"您向编辑函数传入了空内容参数 这将清空页面\\r\\n由于该行为危险 请将config参数的empty键值设定为true来确认","cross_page_edit":"编辑目标位于其他页面 正在获取基础信息","cross_page_edit_submit":"基础信息获取成功 正在提交编辑","cross_page_edit_error":"无法获得基础信息>.<","install_tip":"您是否允许Wikiplus采集非敏感数据用于改进Wikiplus及为当前Wiki: $1 提供改进建议?","accept":"接受","decline":"拒绝","install_finish":"Wikiplus安装完毕","loading":"正在载入","cant_add_funcbtn":"无法增加功能按钮","wikiplus_settings":"Wikiplus设置","wikiplus_settings_desc":"请在下方按规范修改Wikiplus设置","wikiplus_settings_placeholder":"当前设置为空 请在此处按规范修改Wikiplus设置","wikiplus_settings_grammar_error":"设置存在语法错误 请检查后重试","wikiplus_settings_saved":"设置已保存","redirect_from":"将页面重定向至此","redirect_desc":"请输入要重定向至此的页面名","empty_input":"输入不能为空","redirect_saved":"重定向完成","uninited":"Wikiplus未加载完毕 请刷新重试","cant_parse_i18ncache":"无法解析多语言定义文件缓存","cant_load_language":"无法获取多语言定义文件","history_edit_warning":" // 正试图编辑历史版本 这将会应用到本页面的最新版本 请慎重提交","create_page_tip":"\x3c!-- 正在创建新页面 请删去此行注释后继续 --\x3e","continue":"仍然继续","default_summary_suffix":"// Edit via Wikiplus"}'),t=JSON.parse('{"__language":"en-us","__author":["Eridanus Sora","AnnAngela","YinYan"],"__version":"209","unknown_error_name":"Unknown error","api_unaccessiable":"API of this wiki is not available","api_unwriteable":"Write API of this wiki is not available","fail_to_get_timestamp":"Failed to get the timestamp of this page.","fail_to_get_edittoken":"Failed to get the EditToken of this page.","fail_to_get_pageinfo":"Failed to load infomation of this page","not_autoconfirmed_user":"You are not an autoconfiremd user","hit_abusefilter":"Your edit hit the abusefilter(s)","unknown_edit_error":"Unknown edit error","unknown_edit_error_message":"Unknown edit error($1)","notitle":"The title parameter must be set","notext":"The text parameter must be set","notoken":"The token parameter must be set","invalidsection":"The section parameter must be set to an integer or \'new\'","protectedtitle":"This title has been protected from creation","cantcreate":"You don\'t have permission to create new pages","cantcreate_anon":"Anonymous users can\'t create new pages","articleexists":"The article you tried to create has already existed","noimageredirect_anon":"Anonymous users can\'t create image redirects","noimageredirect":"You don\'t have the permission to create image redirects","spamdetected":"Your edit was rejected because it contained a spam fragment","filtered":"The filter callback function rejected your edit","contenttoobig":"The content you submitted exceeds the article size limit","noedit_anon":"Anonymous users can\'t edit pages","noedit":"You don\'t have the permission to edit pages","pagedeleted":"The page was deleted during your edit","emptypage":"Creating new, empty pages is not allowed","emptynewsection":"Creating empty new sections is not possible.","editconflict":"Edit Conflict! Don\'t panic. Please check the difference between your content below and the existing revision, then refresh the page to make another submit","revwrongpage":"The revision you are editing now is not one a valid reversions of this page","undofailure":"Undo failed due to conflicts.","missingtitle":"Missing title in your edit/creation","mustbeposted":"The edit must be submited by POST method","readapidenied":"Read API Denied","writeapidenied":"Write API Denied","noapiwrite":"No available write API in this wiki","badtoken":"Invalid EditToken","missingparam":"One of the parameters title, pageid is required","invalidparammix":"The parameters title, pageid can not be used together","invalidtitle":"Invalid page title","nosuchpageid":"Inexistent page ID","pagecannotexist":"No access to create a new page in this namespace","nosuchrevid":"Inexisting reversion ID","badmd5":"Invalid MD5","hookaborted":"Your edit was rejected by the hook(s)","parseerror":"Failed to parse the wikitext of this page","summaryrequired":"No summary in your edit","blocked":"You has been already BLOCKED","ratelimited":"You\'ve exceeded your rate limit. Please have a tea and try again later","unknownerror":"Unknown error","nosuchsection":"There is no such section","sectionsnotsupported":"Can\'t edit in this section","editnotsupported":"Can\'t edit in this section by writing section","appendnotsupported":"Can\'t append/prepend wikitext to this page","redirect_appendonly":"Only append/prepend can be made to this page because of the rules of the redirect page","badformat":"The requested serialization format can not be applied to the page\'s content model","customcssprotected":"You\'re not allowed to edit custom CSS pages","customjsprotected":"You\'re not allowed to edit custom JavaScript pages","cascadeprotected":"This page is under a cascading protection","network_edit_error":"Failed to edit this page because of network errors","redirect_to_summary":"Redirect to [[$1]] // Wikiplus","redirect_from_summary":"Redirect [[$1]] to [[$2]] // Wikiplus","need_init":"WikiPlus haven\'t been loaded completely. It\'s a rare occasion so you can try to refresh and try again.","fail_to_get_wikitext":"Failed to load the wikitext of this page","quickedit_topbtn":"QuickEdit","quickedit_sectionbtn":"QuickEdit","fail_to_init_quickedit":"Failed to initialize WikiPlus","back":"Back","goto_editbox":"Jump to editbox","summary_placehold":"Edit summary","submit":"Submit","publish_page":"Publish Page","publish_change":"Publish Changes","preview":"Preview","cancel":"Cancel","mark_minoredit":"Mark this edit as a minor edit","onclose_confirm":"[Wikiplus] Do you really want to close this page when you are still editing it, as you will lose all your unsaved work?","fail_to_get_wikitext_when_edit":"Failed to load wikitext for your edit","cant_parse_wikitext":"Failed to parse the wikitext","loading_preview":"Loading the preview","submitting_edit":"Submitting your edit","edit_success":"Your edit is submitted within $1ms","empty_page_confirm":"The wikitext in your edit is empty, which will empty this page.\\r\\nPlease set the value of key \\"empty\\" true to allow this kind of edits. (This is a tip for developers)","cross_page_edit":"The content you are editing belongs to another page, please wait...","cross_page_edit_submit":"Submitting your edit...","cross_page_edit_error":"Failed to load the infomation","install_tip":"Do you allow WikiPlus to collect insensitive data to help us develop WikiPlus and provide feedback to current site: $1 ?","accept":"Yes","decline":"No","install_finish":"Wikiplus is installed, enjoy it","loading":"Loading","cant_add_funcbtn":"Failed to add buttons for WikiPlus","wikiplus_settings":"Wikiplus Setting","wikiplus_settings_desc":"Please modify your setting according to the standards below","wikiplus_settings_placeholder":"Your setting is empty, please modify your setting according to the documentation.","wikiplus_settings_grammar_error":"Syntax error in your setting","wikiplus_settings_saved":"Your settings have been saved","redirect_from":"Redirect from","redirect_desc":"Which page do you want to redirect here?","empty_input":"Empty input","redirect_saved":"Redirection is finished","uninited":"Wikiplus is not completely initialized, please refeash this page","cant_parse_i18ncache":"Failed to parse the cache of i18n file","cant_load_language":"Failed to load i18n file","history_edit_warning":" // You are trying to edit a history revision of this page. This will apply to the latest revision. Please be careful.","create_page_tip":"\x3c!-- You are now creating a new page. Please delete this line and be careful. --\x3e","continue":"Continue anyway","default_summary_suffix":"// Edit via Wikiplus"}');function i(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const a=new class{constructor(){let a;i(this,"language",void 0),i(this,"i18nData",{}),i(this,"sessionUpdateLog",[]);try{a=JSON.parse(localStorage.Wikiplus_Settings).language||window.navigator.language.toLowerCase()}catch(e){a=window.navigator.language.toLowerCase()}this.language=a,this.i18nData["zh-cn"]=e,this.i18nData["en-us"]=t;try{let e=JSON.parse(localStorage.getItem("Wikiplus_i18nCache"));for(const t of Object.keys(e))"zh-cn"!==t&&"en-us"!==t&&(this.i18nData[t]=e[t])}catch(e){localStorage.setItem("Wikiplus_i18nCache","{}")}}translate(e,t=[]){let i="";return this.language in this.i18nData&&e in this.i18nData[this.language]?i=this.i18nData[this.language][e]:this.loadLanguage(this.language),i=e in this.i18nData["en-us"]?this.i18nData["en-us"][e]:e,t.length>0&&t.forEach(((e,t)=>{i=i.replace("$"+(t+1),e)})),i}async loadLanguage(e){if(!this.sessionUpdateLog.includes(e))try{const t=await(await fetch("https://wikiplus-app.com/languages/get.php?lang="+e)).json(),i=localStorage.getItem("Wikiplus_LanguageVersion")||"000";this.sessionUpdateLog.push(e),t.__version===i&&e in this.i18nData||(console.info(`Update ${e} support to version ${t.__version}`),this.i18nData[e]=t,localStorage.setItem("Wikiplus_i18nCache",JSON.stringify(this.i18nData)))}catch(e){}}};const n=class{static debug(e=""){console.debug("[Wikiplus-DEBUG] "+e)}static info(e=""){console.info("[Wikiplus-INFO] "+e)}static error(e,t=[]){let i=a.translate(e);throw t.length>0&&t.forEach(((e,t)=>{i=i.replace(new RegExp("\\"+(t+1),"ig"),e)})),console.error("[Wikiplus-ERROR] "+i),new Error("[Wikiplus-ERROR] "+i)}};function o(){return window.mw.config.get("wgScriptPath")}class s{static async get(e){const t=new URL(s.base);Object.keys(e).forEach((i=>{t.searchParams.append(i,e[i])}));const i=await fetch(t,{credentials:"same-origin"});return await i.json()}static async post(e){const t=new URL(s.base),i=await fetch(t,{method:"POST",body:Object.keys(e).map((t=>t+"="+encodeURIComponent(e[t]))).join("&"),credentials:"same-origin"});return await i.json()}}var r,d,c;r=s,d="base",c=`${location.protocol}//${location.host}${o()}/api.php`,d in r?Object.defineProperty(r,d,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[d]=c;const l=s;const u=class{static async getEditToken(){const e=await l.get({action:"query",meta:"tokens",format:"json"});return e.query&&e.query.tokens&&e.query.tokens.csrftoken&&"+\\"!=e.query.tokens.csrftoken?e.query.tokens.csrftoken:n.error("fail_to_get_edittoken")}static async getTimestamp({title:e,revisionId:t}){try{const i={action:"query",prop:"revisions|info",rvprop:"timestamp",format:"json"};e&&(i.titles=e),t&&(i.revids=t);const a=await l.get(i);if(a.query&&a.query.pages)return"-1"===Object.keys(a.query.pages)[0]?n.error("fail_to_get_edittoken"):a.query.pages[Object.keys(a.query.pages)[0]].revisions[0].timestamp}catch(e){n.error("fail_to_get_edittoken")}}static async getWikiText({section:e,revisionId:t}){try{return await(await fetch(`\n                ${location.protocol}//${location.host}${o()}/index.php?oldid=${t}&section=${e}&action=raw\n            `)).text()}catch(e){n.error("fail_to_get_wikitext")}}static async parseWikiText(e,t="",i={}){try{const i=await l.post({format:"json",action:"parse",text:e,title:t,pst:"true"});if(i.parse&&i.parse.text)return i.parse.text["*"]}catch(e){n.error("cant_parse_wikitext")}}static async edit({title:e,content:t,editToken:i,timestamp:o,config:s={}}={}){try{const r=await l.post({action:"edit",format:"json",text:t,title:e,token:i,basetimestamp:o,...s});if(resposne.edit){if("Success"===r.edit.result)return!0;if(r.edit.code)throw new Error(`\n                            ${a.translate("hit_abusefilter")}:${r.data.info.replace("/Hit AbuseFilter: /ig","")}\n                            <br>\n                            <div style="font-size: smaller;">${r.edit.warning}</div>\n                        `);n.error("unknown_edit_error")}else r.error&&r.error.code?n.error("unknown_edit_error_message",[r.error.code]):r.code?n.error("unknown_edit_error_message",[r.code]):n.error("unknown_edit_error")}catch(e){n.error("network_edit_error")}}};function p(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const g=class{constructor({title:e,revisionId:t}){if(p(this,"timestamp",void 0),p(this,"editToken",void 0),p(this,"title",void 0),p(this,"revisionId",void 0),!e||!t)return n.error("Fail to initialize page instance: Missing page name or revision id.");this.title=e,this.revisionId=t}async init({editToken:e=""}={}){const t=[this.getTimestamp()];e||t.push(this.getEditToken()),await Promise.all(t),n.info(`Page initialization for ${this.title}#${this.revisionId} finished.`)}async getEditToken(){mw.user.tokens.get("csrfToken")&&"+\\"!==mw.user.tokens.get("csrfToken")?this.editToken=mw.user.tokens.get("csrfToken"):this.editToken=await u.getEditToken()}async getTimestamp(){this.timestamp=await u.getTimestamp({revisionId:this.revisionId})}async getWikiText({section:e=""}={}){return u.getWikiText({section:e,revisionId:this.revisionId})}async parseWikiText(e){return u.parseWikiText(e,this.title)}async edit(e){return u.edit({...e,title:this.title,editToken:this.editToken,timestamp:this.timestamp})}};$(document).ready((async()=>{const e={};if(n.info("Wikiplus Now Loading. Version: 3.0.0"),!window.mw)return void console.log("页面Javascript载入不完全或这不是一个Mediawiki站点");if(!window.mw.config.get("wgUserGroups").includes("autoconfirmed"))return void n.error("not_autoconfirmed_user");const t=mw.config.values.wgPageName,i=mw.config.values.wgRevisionId,a=await(async({revisionId:t,title:i})=>{if(e[t])return e[t];const a=new g({revisionId:t,title:i});return await a.init(),e[t]=a,e[t]})({revisionId:i,title:t});console.log(a)}))})();